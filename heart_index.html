<!DOCTYPE html>
<html lang="en" style="height:100%">
	<head>
		<title>Silo6_heart</title>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
		<style>
			body {
				font-family: Monospace;
				background-color: #000;
				color: #fff;
				margin: 0px;
				overflow: hidden;
			}
		</style>
		<link rel="stylesheet" href="styles/new_style.css">
		<link rel="stylesheet" href="styles/circular_slider.css">
		<link rel="stylesheet" href="styles/circular_menu.css">
		<link href="http://netdna.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">
		<script src="js/three.min.js"></script>
		<script src="js/zinc_threejs_control.js"></script>
		<script src="js/zinc_3js_renderer.js"></script>
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
		<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script> 
		<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.5/d3.min.js"></script>
		<script src="http://ajax.googleapis.com/ajax/libs/dojo/1.10.4/dojo/dojo.js" data-dojo-config="async: 1, parseOnLoad: true" ></script>	
		<script src="js/jquery.wheel.js"></script>
		<script>
			var dojoConfig = {
		        async: true,
		        // This code registers the correct location of the "demo" package
		        // so we can load Dojo from the CDN whilst still being able to
		        // load local modules
		        packages: [{
		            name: "js",
		            location: location.pathname.replace(/\/[^/]+$/, '')  + '/js'
		        }]
			};
		</script>
	</head>
	<body style="height:100%;">
	<div id="main_page" class="heartpage">
		<div id="footMore" class="open">
			<div style="position:absolute;left:5%;">
				<img src="images/new_image/click2.png" alt="more" style="height:5%;top:0%;">
			</div>
			<div style="position:absolute;left:75%;">
				<img src="images/new_image/spin2.png" alt="more" style="height:5%;top:0%;">
			</div>
		</div>
		
		
		<div id="rightInformation" class="open">
			<div id="rightECG">
			</div>
			<div class="rightChartTitle" style="top:20%;">
				<b>ECG</b>
			</div>
			<div id="ECGDescription" class="rightChartDescription" style="top:25%;">
				Electrical pulses activates heart muscles to squeeze
			</div>
			<div id="rightLVP">
			</div>
			<div class="rightChartTitle" style="top:59%;">
				<b>LVP</b>
			</div>
			<div id="LVPDescription" class="rightChartDescription" style="top:64%;">
				Muscles squeezes to increase pressure to push blood out
			</div>
			<div id="rightRate">
				<input id="speed_slider" type="range" min="0" max="5000" value ="1000" step="1" oninput="updateSlider(this.value)" style="height: 64px;"/>
			</div>
			<div id="rightRateLabel" style="top:80%;">
				<b>Heart Rate</b>
			</div>
			<div class="rightChartDescription" style="top:85%;">
				make the heart beat faster or slower
			</div>
		</div>
		
		<div id="home" class="closed">
			<img src="images/new_image/home.png" alt="home" style="top:90%;height:100%" onclick="homeClicked()">
		</div>
		
		<div id="halfHeart" class="halfHeart closed">
			<img src="images/new_image/half_heart.png" alt="halfHeart" style="top:90%;height:100%" onclick="halfHeartPressed()">
		</div>
		
		<div id="fullHeart" class="halfHeart closed">
			<img src="images/new_image/full_heart.png" alt="fullHeart" style="top:90%;height:100%" onclick="halfHeartPressed()">
		</div>
		
		
		<div id="initialNormal" class="closed leftPanel">
			<div class="leftTitle" style="color:rgb(0,185,255);" >
				<b>The Heart</b>
			</div>
			<div class="leftDescription" style="color:rgb(0,185,255);">
				<b>Muscles pumping blood</b>
			</div>
			<div class="leftButton" style="left:5%;top:15%;position: absolute;z-index:1;">
				<img src="images/new_image/heart_electricity_2.png" alt="information" style="height:100%" onclick="heartElectricityClicked()">
			</div>
			<div class="leftButton" style="left:5%;top:40%;position: absolute;z-index:1;">
				<img src="images/new_image/heart_attack_2.png" alt="information" style="height:100%" onclick="heartAttackClicked()">
			</div>
			<div class="leftButton" style="left:5%;top:65%;position: absolute;z-index:1;">
				<img src="images/new_image/heart_failure_2.png" alt="information" style="height:100%" onclick="heartFailureClicked()">
			</div>
		</div>
		
		
		<div id="leftHeartElectricity" class="closed leftPanel">
			<div class="leftTitle" style="color:rgb(255,192,0);" >
				<b>Heart Electricity</b>
			</div>
			<div class="leftDescription" style="color:rgb(255,192,0);">
				<b>Coordinated squeezing</b>
			</div>
			<div class="leftDetail" style="color:rgb(175, 175, 175);">
				<b>In a healthy heart, the electrical wave passes through the muscle in an orderly fashion to activate coordinated squeezing.</b>
			</div>
			<div class="leftButton" style="left:5%;top:75%;position: absolute;z-index:1;">
				<img src="images/new_image/arrhythmia_2.png" alt="information" style="height:100%" onclick="arrhythmiaClicked()">
			</div>
		</div>
		
		<div id="leftHeartArrhythmia" class="closed leftPanel">
			<div class="leftTitle" style="color:rgb(255,255,255);" >
				<b>Arrhythmia</b>
			</div>
			<div class="leftDescription" style="color:rgb(255,255,255);">
				<b>Disorderly squeezing</b>
			</div>
			<div class="leftDetail" style="color:rgb(175, 175, 175);">
				<b>The electrical waves are disrupted, the heart cannot contract in a coordinated manner. This fluttering means the heart cannot generate pressure properly and hardly any blood leaves the heart.</b>
			</div>
			<div class="leftButton" style="left:5%;top:75%;position: absolute;z-index:1;">
				<img src="images/new_image/Defibrillate_2.png" alt="information" style="height:100%" onclick="AEDClicked()">
			</div>
		</div>
	
		<div id="leftHeartAttack" class="closed leftPanel">
			<div class="leftTitle" style="color:rgb(106,236,8);" >
				<b>Heart Attack</b>
			</div>
			<div class="leftDescription" style="color:rgb(106,236,8);">
				<b>Dead muscle tissue</b>
			</div>
			<div id="NormalHeartAttackDetail" class="leftDetail closed" style="color:rgb(175, 175, 175);">
				<b>Heart muscles need blood supply just like the rest of the body. In a healthy heart, there are tiny vessels which carry blood to nourish the heart muscles.</b>
				<p><b>However during a heart attack these vessels can become blocked so that blood flow is stemmed to some regions of the heart muscle.</b></p>
				<p><b>Click on the buttons below to see what happens to the heart in heart attack.</b></p>
			</div>
			<div id="MildHeartAttackDetail" class="leftDetail closed" style="color:rgb(175, 175, 175);">
				<b>In a mild heart attack, some of vessels in the heart are blocked, resulting in a small region of dead heart muscle tissue. The pumping performance of the heart is impaired.</b>
			</div>
			<div id="SevereHeartAttackDetail" class="leftDetail closed" style="color:rgb(175, 175, 175);">
				<b>In a severe heart attack, many of the vessels in the heart are blocked. The region of dead tissue is much larger and the pumping performance of the heart is severely affected.</b>
			</div>
			<div id="heartAttackButtonsContainer" class="open">
				<div class="actionButtons" onclick="heartAttackStagePressed('NoInfarct', 'NoHeartAttack', 'NormalHeartAttackDetail')" style="left:5%">
					<div id="NoHeartAttack" class="buttonText"><b>Normal</b></div>
				</div>
			
				<div class="actionButtons" onclick="heartAttackStagePressed('SmallInfarct', 'MildHeartAttack', 'MildHeartAttackDetail')" style="left:30%">
					<div id="MildHeartAttack" class="buttonText"><b>Mild</b></div>
				</div>
			
				<div class="actionButtons" onclick="heartAttackStagePressed('LargeInfarct', 'SevereHeartAttack', 'SevereHeartAttackDetail')" style="left:55%">
					<div id="SevereHeartAttack" class="buttonText"><b>Severe</b></div>
				</div>
		</div>
			
		</div>
	
		<div id="more" class="closed" onclick="moreClicked()">
			<img src="images/more.png" alt="more" style="height:40%;">
		</div>

		
		<div id="myRenderer" class="open" onclick="clearRenderer()">
		</div>


		<div id="SceneButtonsContainer" class="closed">
			<div id="heartElectrictyButton" class="actionButtons" onclick="heartElectricityClicked()" style="left:5%">
				<div class="buttonText">Heart Electricity</div>
			</div>
			<div id="heartAttackButton" class="actionButtons" onclick="heartAttackClicked()" style="left:35%">
				<div class="buttonText">Heart Attack</div>
			</div>
			
			<div id="heartFailureButton" class="actionButtons" onclick="heartFailureClicked()" style="left:65%">
				<div class="buttonText">Heart Failure</div>
			</div>
		</div>

		<div id="circularMenu" class="closed">
		<div class="menu">
  			<div class="btn trigger"> <span class="line"></span> </div>
  			<div class="rotater">
    				<div class="btn btn-icon" onclick="heartElectricityClicked()" id="cicle_top_left">
    					<div class="buttonText">Heart Electricity</div>
    				</div>
  			</div>
			<div class="rotater">
    				<div class="btn btn-icon" onclick="heartAttackClicked()" id="cicle_top_right">
    					<div class="buttonText">Heart Attack</div>
    				</div>
  			</div>
			<div class="rotater">
    				<div class="btn btn-icon" onclick="heartFailureClicked()" id="cicle_bottom">
    					<div class="buttonText">Heart Failure</div>
    				</div>
  			</div>
		</div>
		</div>
		<script>
			$(document).ready(function() {
  				$(".trigger").click(function() {
    					$(".menu").toggleClass("active"); 
  				});
			});
		</script>
	</div>
	
	<script>
		var ECGchart = undefined;
		var LVPchart = undefined;
		var ECGurls = [];
		var LVPurls = [];
		var ECGs = [];
		var LVPs = [];
		var ECGTexts = [];
		var LVPTexts = [];
		var modelURLsArray = [];
		var currentECGName = 'None';
		var currentLVPName = 'None';
		var ecgIndicator = undefined;
		var lvpIndicator = undefined;
		var maxECGTime = 0.0, maxLVPTime = 0.0;
		var minECGTime = 0.0, minLVPTime = 0.0
		var timeLineOffset = 0.0;
		setUpArrays();
		var container = document.getElementById('myRenderer')
		var zincRenderer = new Zinc.Renderer(container, window);
		Zinc.defaultMaterialColor = 0xFFFF9C;
		zincRenderer.initialiseVisualisation();
		zincRenderer.getThreeJSRenderer().setClearColor( 0xffffff, 0);
		var halfHeartFlag = false;
		var leftPanelIDs = ["initialNormal", "leftHeartElectricity", "leftHeartArrhythmia", "leftHeartAttack"];

		
		function displayHalfHeartIcon() {
			if (halfHeartFlag) {
				document.getElementById('halfHeart').classList.remove('open');
				document.getElementById('halfHeart').classList.add('closed');
				document.getElementById('fullHeart').classList.remove('closed');
				document.getElementById('fullHeart').classList.add('open');
			} else {
				document.getElementById('halfHeart').classList.remove('closed');
				document.getElementById('halfHeart').classList.add('open');
				document.getElementById('fullHeart').classList.remove('open');
				document.getElementById('fullHeart').classList.add('closed');
			}
		}
		
		
		function homeClicked() {
			leftPanelTrigger(undefined);
			document.getElementById('rightInformation').className = 'closed';
			document.getElementById('home').className = 'closed';
			document.getElementById('footMore').className = 'open';
			document.getElementById('halfHeart').classList.remove('open');
			document.getElementById('halfHeart').classList.add('closed');
			document.getElementById('fullHeart').classList.remove('open');
			document.getElementById('fullHeart').classList.add('closed');
			loadModel("DeformingHeart", 1.0);
		}
		
		
		function leftPanelTrigger(elementIdToDisplay) {
			for(var i = 0; i < leftPanelIDs.length; i++){
    			var id = leftPanelIDs[i];
				document.getElementById(id).classList.remove('open');
				document.getElementById(id).classList.add('closed');
			}
			if (elementIdToDisplay) {
				document.getElementById(elementIdToDisplay).classList.remove('closed');
				document.getElementById(elementIdToDisplay).classList.add('open');
			}
		}
		
		var pageClicked = function() {
			if (document.getElementById('footMore').className == 'open'){
				leftPanelTrigger('initialNormal');
				document.getElementById('footMore').className = 'closed';
				document.getElementById('rightInformation').className = 'open';
				document.getElementById('home').className = 'open';
				displayHalfHeartIcon();
				showECGAndLVP("Normal", -0.075);
			}
		}
		
		function heartElectricityClicked() {
			leftPanelTrigger('leftHeartElectricity');
			loadModel('NormalElectricity', 1.0);
			showECGAndLVP('Normal', 0.0);
		}
		
		function arrhythmiaClicked() {
			leftPanelTrigger('leftHeartArrhythmia');
			loadModel('ArrythmiaElectricity', 0.25);
			showECGAndLVP('Arrhythmia', 0.0);
		}
		
		function AEDClicked() {
			leftPanelTrigger('leftHeartElectricity');
			loadModel('NormalElectricity', 1.0);
			showECGAndLVP('Normal', 0.0);
		}
		
		var heartAttackStagePressed = function(StageName, pressedElement, descriptionId) {
			loadModel(StageName, 1.0);
			showECGAndLVP(StageName, 0.0);
			document.getElementById('NoHeartAttack').style.color = "rgb(106,236,8)";
			document.getElementById('MildHeartAttack').style.color = "rgb(106,236,8)";
			document.getElementById('SevereHeartAttack').style.color = "rgb(106,236,8)";
			document.getElementById('NormalHeartAttackDetail').classList.remove('open');
			document.getElementById('NormalHeartAttackDetail').classList.add('closed');
			document.getElementById('MildHeartAttackDetail').classList.remove('open');
			document.getElementById('MildHeartAttackDetail').classList.add('closed');
			document.getElementById('SevereHeartAttackDetail').classList.remove('open');
			document.getElementById('SevereHeartAttackDetail').classList.add('closed');
			document.getElementById(descriptionId).classList.remove('closed');
			document.getElementById(descriptionId).classList.add('open');
			document.getElementById(pressedElement).style.color = "rgb(255,255,255)";
		}
		
		function heartAttackClicked() {
			leftPanelTrigger('leftHeartAttack');
			heartAttackStagePressed('NoInfarct','NoHeartAttack', 'NormalHeartAttackDetail');
		}
		
		var dragFlag = 0;
		container.addEventListener("mousedown", function() {flag = 0;}, false);
		container.addEventListener("mousemove", function() {flag = 1;}, false);
		container.addEventListener("mouseup", function(){
		    if(flag === 0){pageClicked();}}, false);
		
		loadModel("DeformingHeart", 1.0);
		zincRenderer.animate();
		document.getElementById("speed_slider").value = 1000;
		
		var updateIndicators = function() {
			var normaliseTime = zincRenderer.getCurrentTime() / 3000.0;
			if (lvpIndicator && (currentLVPName != ' None') &&
				ecgIndicator && (currentECGName != ' None') &&
				document.getElementById('rightInformation').className.includes("open")) {
				var lvpTime = normaliseTime * (maxLVPTime - minLVPTime) + minLVPTime;
				var ecgTime = normaliseTime * (maxECGTime - minECGTime) + minECGTime;
				if (timeLineOffset != 0.0) {
        			lvpTime = lvpTime + timeLineOffset;
        			ecgTime = ecgTime + timeLineOffset;
        			if (lvpTime > maxLVPTime) {
        				lvpTime = lvpTime - maxLVPTime + minLVPTime;
        			} else if ( lvpTime < minLVPTime) {
        				lvpTime = maxLVPTime - (minLVPTime - lvpTime);
        			}
        			if (ecgTime > maxECGTime) {
        				ecgTime = ecgTime - maxECGTime + minECGTime;
        			} else if ( ecgTime < minECGTime) {
        				ecgTime = maxECGTime - (minECGTime - ecgTime);
        			}
        		}
        		lvpIndicator.opt.values = [lvpTime];
        		ecgIndicator.opt.values = [ecgTime];
        		lvpIndicator.dirty = true;
        		lvpIndicator.render();
        		ecgIndicator.dirty = true;
        		ecgIndicator.render();
			}
		}
		
		zincRenderer.addPreRenderCallbackFunction(updateIndicators);
		
		var geometryShowHalf = function() {
			return function(zincGeometry) {
				if (zincGeometry.groupName && zincGeometry.groupName.includes("Post")) {
					zincGeometry.setVisibility(!halfHeartFlag);
				}
			}
		}
		
		var showHalf = function () {
			var currentScene = zincRenderer.getCurrentScene();
			currentScene.forEachGeometry(geometryShowHalf());
		}
		
		var halfHeartPressed = function() {
			if (halfHeartFlag) {
				halfHeartFlag = false;
			} else {
				halfHeartFlag = true;
			}
			displayHalfHeartIcon();
			
			showHalf();
		}
	
		function setUpArrays() {
			ECGurls['Normal'] = 'ECG/NormalECG.json';
			ECGurls['Diastolic'] = 'ECG/DiastolicECG.json';
			ECGurls['Systolic'] = 'ECG/SystolicECG.json';
			LVPurls['Normal'] = 'LVP/NormalLVP.json';
			LVPurls['Diastolic'] = 'LVP/DiastolicLVP.json';
			LVPurls['Systolic'] = 'LVP/SystolicLVP.json';
			ECGurls['NoInfarct'] = 'ECG/NormalECG.json';
			ECGurls['SmallInfarct'] = 'ECG/MildInfarctECG.json';
			ECGurls['LargeInfarct'] = 'ECG/LargeInfarctECG.json';
			LVPurls['NoInfarct'] = 'LVP/NormalLVP.json';
			LVPurls['SmallInfarct'] = 'LVP/smallInfarctLVP.json';
			LVPurls['LargeInfarct'] = 'LVP/largeInfarctLVP.json';
			ECGurls['Arrhythmia'] = 'ECG/ArrhythmiaECG.json';
			LVPurls['Arrhythmia'] = 'LVP/ArrhythmiaLVP.json';
			
			modelURLsArray['DeformingHeart'] = ['models/deforming_heart_metadata.json',
				'models/deforming_heart_view.json'];
			modelURLsArray['NormalElectricity'] = ['heartElectricity/normalActivity_metadata.json',
				'heartElectricity/normalActivity_view.json'];
			modelURLsArray['ArrythmiaElectricity'] = ['heartElectricity/arrythmiaActivity_metadata.json',
				'heartElectricity/arrythmiaActivity_view.json'];
			modelURLsArray['LargeInfarct'] = ['heartInfarct/largeInfarct_metadata.json',
				'heartInfarct/largeInfarct_view.json'];
			modelURLsArray['SmallInfarct'] = ['heartInfarct/smallInfarct_metadata.json',
				'heartInfarct/smallInfarct_view.json'];
			modelURLsArray['NoInfarct'] = ['heartInfarct/noInfarct_metadata.json',
				'heartInfarct/noInfarct_view.json'];
				
			ECGTexts['Normal'] = "Electrical pulses activates heart muscles to squeeze";
			LVPTexts['Normal'] = "Muscles squeezes to increase pressure to push blood out";
			ECGTexts['Arrhythmia'] = "Abnormal electrical pattern";
			LVPTexts['Arrhythmia'] = "Very little pressure produced";
			ECGTexts['NoInfarct'] = "Electrical pulses activates heart muscles to squeeze";
			LVPTexts['NoInfarct'] = "Muscles squeezes to increase pressure to push blood out";
			ECGTexts['SmallInfarct'] = "Electrical pulses activates heart muscles to squeeze";
			LVPTexts['SmallInfarct'] = "Dead muscle means less squeeze force and less pressure generated";
			ECGTexts['LargeInfarct'] = "Electrical pulses activates heart muscles to squeeze";
			LVPTexts['LargeInfarct'] = "Dead muscle means less squeeze force and less pressure generated";
		}
		
		
		require(["dojo/ready"], function(ready){
			ready(function(){
				require([ "dojo/_base/declare", "dojo/dom-construct","dojox/charting/Chart", "dojox/charting/plot2d/StackedLines", "dojox/charting/plot2d/Grid", "dojox/charting/themes/Claro", "dojox/charting/axis2d/Default", "dojox/charting/plot2d/Indicator"], 
					function(declare, domConstruct, Chart, StackedLines, Grid, Claro, axis2dDefault, plot2dIndicator){
						ready(function(){
								/* get the html element (dom) where we want the chart to be drawn on */
								var chartDom = document.getElementById("rightECG");
								/* create the chart on the dom */
								ECGchart = new Chart(chartDom, {title: "ECG", titleGap: 0, titleFont: "normal normal normal 13pt Arial"});
								/* add the x-axis */
								ECGchart.addAxis("x", {type: "Invisible", majorLabels: false,
									minorTicks: false,
									minorLabels: false,
									microTicks: false});		
								/* add the y-axis */
								ECGchart.addAxis("y", {type: "Invisible", vertical: true,
									majorLabels: false,
									minorTicks: false,
									minorLabels: false,
									microTicks: false});
								/* optional add the grid */
								ECGchart.addPlot("grid", { type: Grid,
									hMajorLines: false,
									hMinorLines: false, 
									vMajorLines: false,
									vMinorLines: false,
									majorHLine: { color: "green", width: 0.2 },
									majorVLine: { color: "red", width: 0.2 } });
							
							   ECGchart.addPlot("time", { type: plot2dIndicator,
				        			vertical: true,
				        			lineStroke: { color: "blue"},
				        			labels: null,
				        			stroke: null,
				        			outline: null,
				        			fill: null,
				        			offset: { y: -7, x: -10 },
				        			values: 0.0});
								ecgIndicator = ECGchart.getPlot("time");
	
								/* get the html element (dom) where we want the chart to be drawn on */
								var chartDom = document.getElementById("rightLVP");
								/* create the chart on the dom */
								LVPchart = new Chart(chartDom, {title: "Pressure", titleGap: 0, titleFont: "normal normal normal 13pt Arial"});
								/* add the x-axis */
								LVPchart.addAxis("x", {type: "Invisible",
									majorLabels: false,
									minorTicks: false,
									minorLabels: false,
									microTicks: false});
								/* add the y-axis */
								LVPchart.addAxis("y", {
									vertical: true,
									min: 0,
									max: 150});
								/* optional add the grid */
								LVPchart.addPlot("grid", { type: Grid,
									hMajorLines: false,
									hMinorLines: false, 
									vMajorLines: false,
									vMinorLines: false,
									majorHLine: { color: "green", width: 0.2 },
									majorVLine: { color: "red", width: 0.2 } });
								LVPchart.addPlot("time", { type: plot2dIndicator,
				        			vertical: true,
				        			lineStroke: { color: "blue"},
				        			labels: null,
				        			stroke: null,
				        			outline: null,
				        			fill: null,
				        			offset: { y: -7, x: -10 },
				        			values: 0.0});
								lvpIndicator = LVPchart.getPlot("time");
								document.getElementById('rightInformation').className = 'closed';
							});
					});
			});
		});
		
		function updateInfoText(text) {
			document.getElementById('headerInfoText').innerHTML = text;
		}
			
		function infoClicked() {
			if (document.getElementById('myRenderer').className == 'open'){
				$('#headerTitleHeaderBackround').slideToggle();
			}
		}


		function moreClicked() {
			document.getElementById('circularMenu').className = 'open';
			document.getElementById('more').className = 'closed';
		}
		
				
		function loadViewModel(model_name, modelURLs) {
			var scene = zincRenderer.getSceneByName(model_name);
			if (scene == undefined) {
				scene = zincRenderer.createScene(model_name);
				scene.loadFromViewURL(modelURLs);
				scene.resetView();
			}
			zincRenderer.setCurrentScene(scene);
		}
		
		function loadModel(model_name, rateScaling) {
			metaURL = modelURLsArray[model_name][0];
			viewURL = modelURLsArray[model_name][1];
			var scene = zincRenderer.getSceneByName(model_name);
			if (scene == undefined) {
				scene = zincRenderer.createScene(model_name);
				scene.setDuration(scene.getDuration() / rateScaling);
				scene.loadViewURL(viewURL);
				scene.loadMetadataURL(metaURL);
			}
			scene.resetView();
			zincRenderer.setCurrentScene(scene);
		}

		function clearRenderer(){
			if (document.getElementById('circularMenu').className=='open') {
				document.getElementById('circularMenu').className='closed';
				document.getElementById('more').className='closed';
				document.getElementById('headerTitleHeaderBackround').className='closed';
			}
		}		

		function resetView()	{
			zincRenderer.viewAll()
		}
		
		function heartFailureClicked() {
			document.getElementById('heartAttackButtonsContainer').className = 'closed';
			document.getElementById('arrhythmia').className = 'closed';
			document.getElementById('AED').className = 'closed';
			document.getElementById('heartElectrictyButton').classList.remove('selectedItem');
			document.getElementById('heartAttackButton').classList.remove('selectedItem');
			document.getElementById('heartFailureButton').classList.add('selectedItem');
			heartElectrictyButton
			updateInfoText("Heart Failure");
		}
		
		function updateSlider(newValue)	{
			zincRenderer.setPlayRate(newValue);
		}
		
		var showLVPInternal = function(chartName) {
			if (chartName != currentLVPName) {
				var currentLVP = LVPs[chartName];
				maxLVPTime = currentLVP[currentLVP.length - 1]['x'];
				minLVPTime = currentLVP[0]['x'];
				LVPchart.removeSeries(currentLVPName);
				currentLVPName = chartName;
				LVPchart.addSeries(chartName, currentLVP, { stroke: "green"});
				LVPchart.render();
				LVPchart.resize('100%','100%');
			}
		}
		
		var onLVPLoaded = function(xmlhttp, chartName) {
			return function() {
				if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
					var viewData = JSON.parse(xmlhttp.responseText);
					LVPs[chartName] = viewData;
					showLVPInternal(chartName);
				}
			};
		}
		
		var showECGInternal = function(chartName) {
			if (chartName != currentECGName) {
				var currentECG = ECGs[chartName];
				maxECGTime = currentECG[currentECG.length - 1]['x'];
				minECGTime = currentECG[0]['x'];
				ECGchart.removeSeries(currentECGName);
				currentECGName = chartName;
				ECGchart.addSeries(chartName, currentECG, { stroke: "green"});
				ECGchart.render();
				ECGchart.resize('100%','100%');
			}
		}
		
		var onECGLoaded = function(xmlhttp, chartName) {
			return function() {
				if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
					var viewData = JSON.parse(xmlhttp.responseText);
					ECGs[chartName] = viewData;
					showECGInternal(chartName);
				}
			};
		}
		
		function showECGAndLVP(chartName, timeOffset) {
			timeLineOffset = timeOffset;
			if (ECGs[chartName]) {
				showECGInternal(chartName);
			} else {
				var xmlhttp = new XMLHttpRequest();	
				xmlhttp.onreadystatechange = onECGLoaded(xmlhttp, chartName);
				requestURL = ECGurls[chartName];
				xmlhttp.open("GET", requestURL, true);
				xmlhttp.send();
			}
			
			if (LVPs[chartName]) {
				showLVPInternal(chartName);
			} else {
				var xmlhttp = new XMLHttpRequest();	
				xmlhttp.onreadystatechange = onLVPLoaded(xmlhttp, chartName);
				requestURL = LVPurls[chartName];
				xmlhttp.open("GET", requestURL, true);
				xmlhttp.send();
			}
			if (ECGTexts[chartName])
				document.getElementById('ECGDescription').innerHTML = ECGTexts[chartName];
			if (LVPTexts[chartName])
				document.getElementById('LVPDescription').innerHTML = LVPTexts[chartName];
		}
				
	</script>
	
	
	</body>
</html>
